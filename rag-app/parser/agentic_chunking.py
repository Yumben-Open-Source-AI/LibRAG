import uuid
import json
from typing import List, Dict
from pydantic import BaseModel
from dotenv import load_dotenv
from llm.qwen import Qwen

# 加载配置文件密钥
load_dotenv()
qwen = Qwen()

# === Pydantic 模型定义 ===

class ChunkMeta(BaseModel):
    chunk_id: str
    title: str
    summary: str
    propositions: List[str]


# === LLM 角色设定 ===
PROPOSITION_MESSAGES = [{ 'role': 'system', 'content': """
            # Role: 内容命题拆解专家
            ## Profile              
            - author: LangGPT
            - version: 1.0
            - language: 中文
            - description: 将长文本拆解为清晰、简单、脱离上下文可独立理解的命题，以JSON字符串列表的形式输出。
            
            ## Skills
            - 拆分并列句为简单句，尽量保持原始措辞。
            - 将带有描述性信息的命名实体与主体信息分开成独立命题。
            - 替换代词为完整实体名词，并适度补充修饰信息确保句子独立可理解。
            - 精确遵循JSON数组输出格式，确保每条是独立命题。
            
            ## Background
            在处理中文复杂叙述时，为方便知识抽取、AI学习或信息重组，需要将原文信息结构化为独立、完整的小命题单元。
            
            ## Goals
            帮助用户将长文内容拆分为规范、清晰的小命题列表，便于后续处理。
            
            ## OutputFormat
            输出一个JSON数组，每个元素是一个完整、可独立理解的简单命题字符串。
            
            ## Rules
            - 保持输入原文措辞，只在必要时补充修饰或改写以保证独立性。
            - 代词（如“他”、“她”、“它”、“他们”等）需替换为所指实体全名。
            - 一个简单句只描述一个核心事实或描述。
            - 忠实于原文，不添加主观推断。
            - 代词回指处理，补全引用实体。
            
            ## Workflows
            1. 阅读并理解输入文本内容和逻辑结构。
            2. 逐句分析并列关系，拆分成独立简单句。
            3. 分离命名实体及其描述，补充必要信息。
            4. 代词回指处理，补全引用实体。
            5. 生成JSON数组形式的输出，每条为独立命题。
            
            ## Init
            你好！我是内容命题拆解专家✍️。请发送你想拆解的内容，我会帮你规范化处理成清晰的命题列表，方便你后续使用。""" }, {'role': 'user'}]

SUMMARY_MESSAGES = [{ 'role': 'system', 'content': """
            # Role: 文本摘要与标题生成专家（summary_llm）
            ## Profile
            - author: LangGPT
            - version: 1.0
            - language: 中文
            - description: 针对给定的一段文本块，生成一个简明扼要的摘要，以及一个精准概括内容的标题。
            
            ## Skills
            - 从复杂文本中提取关键信息。
            - 用简洁、准确的语言总结文本内容。
            - 根据文本主旨创作具有概括性的标题。
            
            ## Background
            在处理大量文本信息时，需要快速提取要点和生成清晰的标题，以便于信息检索、归类和阅读。
            
            ## Goals
            帮助用户从任意文本中提炼出高质量的摘要和符合内容主题的标题。
            
            ## OutputFormat
            输出一个JSON对象，格式如下：
            { 
            "title": "简洁概括的标题",
            "summary": "简明扼要的摘要"
            }
            
            ## Rules
            - 摘要应覆盖文本中的主要观点，控制在50-150字以内。
            - 标题应高度凝练，不超过15字。
            - 保持客观、中立，不添加主观评价。
            - 必须用标准中文输出。
            
            ## Workflows
            1. 阅读输入文本，理解核心内容和主旨。
            2. 提取文本中的关键信息和重要细节。
            3. 生成内容清晰、易于理解的摘要。
            4. 创作符合内容主题且吸引人的标题。
            
            ## Init
            你好！我是 summary_llm 文本摘要与标题生成专家✍️。请发送你需要处理的文本块，我会帮你提炼出精华摘要并拟定标题。""" }, {'role': 'user'}]

ALLOCATION_MESSAGES = [{ 'role': 'system', 'content': """
            # Role: 命题归块判断与分配专家（allocation_llm）
            ## Profile
            - author: LangGPT
            - version: 1.0
            - language: 中文
            - description: 根据命题的主题大意，判断应将其归入哪个现有块，或是否需要新建一个块。判断时优先考虑语义相近的主题进行泛化归类。
            
            ## Skills
            - 理解命题的核心主题与含义。
            - 将主题相近、方向一致的命题合并到同一类。
            - 在无明确相似块时，合理建议新建块。
            
            ## Background
            在知识整理过程中，过度细化会导致冗余。需要以主题为基础，对命题进行泛化归类，提高结构紧凑性与整体可读性。
            
            ## Goals
            帮助用户将主题相近的命题归入同一块，降低碎片化程度，增强信息组织的聚合度。
            
            ## OutputFormat
            输出一个JSON对象，格式如下：
            {
              "action": "assign" 或 "create_new",
              "target_block_id": "（如果是 assign，填匹配的块id）"
            }
            
            ## Rules
            - 优先将主题相关的命题聚合到已有块中，即使细节不同。
            - 仅在新命题的主题明显与所有块不相关时，才建议创建新块。
            - 聚焦于“语义相似性”，而非完全内容重复。
            - 不要解释你的行为。
            
            ## Workflows
            1. 阅读当前命题，理解其核心主题。
            2. 浏览所有已有块摘要，寻找主题相近者。
            3. 判断是否可以归类到某一块，或是否有必要新建块。
            4. 输出操作建议（assign 或 create_new）。
            
            ## Init
            你好！我是 allocation_llm 命题归块判断专家✍️。请提供新命题和现有块摘要信息，我将帮你进行泛化归类判断。""" }, {'role': 'user'}]

# === LLM实例 ===
summary_llm = qwen
allocation_llm = qwen

# === 核心模块 ===
chunks: Dict[str, ChunkMeta] = {}

# 新建块
def create_new_chunk(proposition: str) -> str:
    chunk_id = str(uuid.uuid4())
    SUMMARY_MESSAGES[1]['content'] = f'txt_chunk:{proposition};'
    print("SUMMARY_MESSAGES:"+str(SUMMARY_MESSAGES[1]))
    result = summary_llm.chat(SUMMARY_MESSAGES)[0]
    print("SUMMARY_RESULT:"+str(result))
    new_chunk = ChunkMeta(
        chunk_id=chunk_id,
        title=result.get('title', ''),
        summary=result.get('summary', ''),
        propositions=[proposition]
    )
    chunks[chunk_id] = new_chunk
    return chunk_id

# 添加命题到已有块
def add_proposition(chunk_id: str, proposition: str):
    chunk = chunks[chunk_id]
    chunk.propositions.append(proposition)
    # 更新块的标题和摘要
    SUMMARY_MESSAGES[1]['content'] = f'txt_chunk:{" ".join(chunk.propositions)};'
    print("SUMMARY_MESSAGES:"+str(SUMMARY_MESSAGES[1]))
    result = summary_llm.chat(SUMMARY_MESSAGES)[0]
    print("SUMMARY_RESULT:"+str(result))
    chunk.title = result.get('title', chunk.title)
    chunk.summary = result.get('summary', chunk.summary)
    chunks[chunk_id] = chunk

# 决定放到哪个块
def find_chunk_and_push_proposition(proposition: str):
    if not chunks:
        create_new_chunk(proposition)
        return

    chunks_summaries = {chunk_id: chunk.summary for chunk_id, chunk in chunks.items()}
    ALLOCATION_MESSAGES[1]['content'] = f'已有块信息:{json.dumps(chunks_summaries, ensure_ascii=False)};proposition:{proposition};'
    print("ALLOCATION_MESSAGES:"+str(ALLOCATION_MESSAGES[1]))
    result = allocation_llm.chat(ALLOCATION_MESSAGES)[0]
    print("ALLOCATION_RESULT:"+str(result))
    action = result.get('action')
    if action == 'create_new':
        create_new_chunk(proposition)
    elif action == 'assign':
        target_chunk_id = result.get('target_block_id')
        if target_chunk_id in chunks:
            add_proposition(target_chunk_id, proposition)
        else:
            create_new_chunk(proposition)

# === 主流程 ===
def extraction_chain(txt: str):
    PROPOSITION_MESSAGES[1]['content'] = txt
    print("PROPOSITION_MESSAGES:"+ str(PROPOSITION_MESSAGES[1]))
    result = qwen.chat(PROPOSITION_MESSAGES)[0]
    print("PROPOSITION_REQUEST:"+ str(result))
    proposition_list = result

    for proposition in proposition_list:
        print("PROPOSITION:"+proposition)
        find_chunk_and_push_proposition(proposition)

    # 输出整理结果
    print(json.dumps([chunk.dict() for chunk in chunks.values()], ensure_ascii=False, indent=2))

if __name__ == "__main__":
    print("请输入文本，结束后回车空行：")
    lines = []
    while True:
        line = input()
        if line == "":
            break
        lines.append(line)
    text = "\n".join(lines)
    import time
    start_time = time.time()
    extraction_chain(text)
    end_time = time.time()
    print("程序运行时间：%s 秒" % (end_time - start_time))
    #贵阳农商银行超值宝定开1年8期
    # 理财产品说明书
    # 尊敬的投资者，感谢您选择贵阳农村商业银行股份有限公司（以下简称“贵阳农商银行”）理财产品！您购买本款产品是由贵阳农商银行自主设计、投资、运作的理财产品。为保障您的合法权益，请您在进行金融投资时，警惕任何人与机构假借我行理财产品之名推介、推销其他类型产品。
    # 一、重要须知
    # 1.在购买理财产品前，您应仔细阅读理财产品销售文件，包括理财产品说明书、贵阳农商银行理财产品协议书、贵阳农商银行理财产品投资者权益须知、贵阳农商银行风险承受能力评估书、贵阳农商银行理财产品风险揭示书、信息授权书（理财业务版），确保自己完全理解该项投资的性质和所涉及的风险，详细了解和审慎评估该理财产品的资金投向、风险类型、业绩比较基准等情况，在慎重考虑后自行决定购买与自身风险承受能力和资产管理需求相匹配的理财产品；在购买理财产品后，您应随时关注本理财产品的信息披露情况，及时获取相关信息。
    # 2.无论您是否签署，如您购买本理财产品，即视为您已阅读、理解理财产品销售文件，并同意接受理财产品销售文件所有内容的约束。
    # 3.理财非存款、产品有风险、投资须谨慎。
    # 4.理财产品过往业绩不代表其未来表现，不等于理财产品实际收益，投资须谨慎。
    # 二、产品要素
    # 产品名称	超值宝定开1年8期理财产品
    # 产品编号	GRCB022024009
    # 产品登记编码	C1188324000013
    # 可依据该编码在中国理财网（www.chinawealth.com.cn）上查询产品信息。
    # 产品类型	固定收益类
    # 募集方式	公募
    # 运作方式	开放式
    # 业绩比较基准	【2.60%-3.60%】/年
    # 1.释义：业绩比较基准指资产管理人根据市场情况、本理财产品运行情况所设定的提取业绩报酬的标准。业绩比较基准不构成对委托财产收益的任何明示、暗示或保证。
    # 2.测算依据：本产品主要投资于现金类资产、货币类资产、货币市场基金、债券型基金、标准化固定收益类资产及符合前述投向的信托计划、资产管理计划，投资比例为80%-100%。业绩比较基准是根据产品的投资范围和周期，综合评估宏观经济环境、债券市场历史趋势、近期利率水平等情况，结合产品投资策略进行测算，扣除销售费、管理费、托管费等所有费用后，综合得到产品业绩比较基准。
    # 3.产品存续期内，贵阳农商银行可根据市场情况等调整业绩比较基准，并至少于新的业绩比较基准启用日之前2个工作日进行公告（公告方式为贵阳农商银行营业网点、官方网站等任一渠道）。
    # 4.业绩比较基准不是预期收益率，不代表产品的未来表现和实际收益，不构成对产品收益的承诺。
    # 目标投资者	经贵阳农商银行评估为稳健型、平衡型、成长型、进取型的个人投资者
    # 内部风险评级	二级（较低风险级别）
    # 本金及收益币种	人民币
    # 产品规模	产品募集上限为40000万元，下限为1000万元。
    # 贵阳农商银行可根据市场情况等调整产品规模上下限。
    # 认购	认购是指投资者在产品募集期申请购买理财产品。
    # 申购	申购是指投资者在产品开放期申请购买理财产品。
    # 认购/申购面值	本理财产品认购/申购面值为1元/份，即单位初始份额净值为1元/份
    # 起购金额	个人投资者起购金额为1万元，以1万元的整数倍递增。
    # 申购上限	单个投资者持有份额不超过2000万元，超出部分贵阳农商银行根据实际情况将限制申购。
    # 销售渠道	贵阳农商银行营业网点、手机银行等电子渠道
    # 工作日	产品存续期内每一国家法定工作日为工作日。
    # 募集期	2024年2月15日-2024年2月25日 。
    # 产品管理人有权根据市场情况提前结束或延长产品募集时间并相应调整产品成立日。
    # 封闭期	封闭期约为1年，每个封闭期运作天数按照实际天数计算。
    # 开放期	1.每年2月15日9:00-2月24日16:59为产品开放期，投资者可在该期间进行申购或赎回。
    # 2.若开放期最后一日遇国家法定节假日，则顺延至下一个工作日，若有调整以贵阳农商银行官方公告为准（调整公告于每一个开放期前一个工作日通过贵阳农商银行营业网点、官方网站等任一渠道公布）。
    # 3.开放日是指开放期内投资者可以申购、赎回本理财产品的任一日。
    # 成立日	2024年2月26日
    # 贵阳农商银行有权提前结束募集并成立产品，成立产品当天通过贵阳农商银行营业网点、官方网站等任一渠道公布。
    # 产品期限	1.本期产品期限20年，实际产品期限受制于提前终止条款。
    # 2.贵阳农商银行有权提前终止产品。贵阳农商银行提前终止产品时，将至少于提前终止日之前2个工作日内通过贵阳农商银行营业网点、官方网站等任一渠道公布。
    # 清算日	开放期结束日下一个工作日为产品清算日，投资者赎回金额采用清算日前一工作日产品净值进行确认。
    # 收益分配日	产品收益将在清算日后3个工作日内进行收益分配，收益以现金形式分配至投资者账户。
    # 兑付日	兑付日为清算日后的3个工作日内，将对成功申请赎回的份额进行兑付。
    # 到期资金	本产品到期资金=持有份额×到期日产品单位净值（到期资金按四舍五入原则，保留至小数点后2位）。
    # 赎回	1.投资者在开放期内未发起赎回申请的，投资者持有份额将自动进入下一个封闭期，依次循环直至产品到期。
    # 2.在开放期内申请赎回交易的，管理人将统一在清算日进行确认。投资者申请赎回并不代表赎回成功，赎回是否成功以管理人的确认结果为准。
    # 3.赎回份额以 1万份的整数倍递增。
    # 预约赎回	1.预约赎回期为整个产品封闭期（若有调整，调整公告于开放期结束日前3个工作日内通过贵阳农商银行营业网点、官方网站等任一渠道公布）。
    # 2.本产品设置预约赎回期，投资者可在此期间发起预约赎回申请及撤销预约赎回申请，预约赎回将统一在清算日生效，并确认赎回份额，且确认赎回份额适用巨额赎回的规则。
    # 巨额赎回	1.净赎回份额是指投资者赎回申请份额总数扣除申购申请份额总数后的份额。
    # 2.巨额赎回是指理财产品单个开放日净赎回份额申请超过前一日终理财产品总份额10%的赎回行为。
    # 3.发生巨额赎回时，管理人有权依照时间优先原则，拒绝超过理财产品净赎回份额10%以上部分的赎回申请，被拒绝的投资者可于开放期内下一开放日重新提交赎回申请。
    # 4.若理财产品连续2个开放日（含）及以上发生巨额赎回，管理人有权依照时间优先原则，拒绝超过理财产品净赎回份额10%以上部分的赎回申请，投资者可于开放期内下一开放日重新提交赎回申请。对于已经接受的赎回申请，管理人有权延缓支付赎回款项，延缓期限自理财产品兑付日起不超过15个工作日。
    # 5.如开放期最后一日发生巨额赎回情形，管理人有权根据实际情况决定是否接受赎回申请，如接受赎回申请的，管理人有权自理财产品兑付日起不超过15个工作日支付赎回款项。
    # 产品单位净值	理财产品单位净值是指理财产品净资产除以理财产品总份额得出的每份理财产品当日价值。资产管理人每个估值日根据对应产品所投资资产市场价格计算产品总资产价值， 并扣除各类成本及费用后，除以理财产品当前总份额，即为理财产品单位净值，净值的计算按四舍五入原则保留到小数点后第四位。
    # 净值公布	本产品存续期内：每周前2个工作日内公布截至上周最后一个工作日产品单位净值。产品开放期结束或提前终止后，在产品开放期结束或提前终止日（如遇非工作日，则顺延至下一个工作日）后的2个工作日内发布产品收益分配日或提前终止日的产品单位净值。产品单位净值的计算按照四舍五入原则，保留至小数点后4位。
    # 税款	贵阳农商银行暂不负责代扣代缴投资者购买本产品所得收益应缴纳的各项税款。若相关法律法规、税收政策规定产品管理人应代扣代缴相关税款，贵阳农商银行有权依法履行代扣代缴义务。
    # 最不利情况示例	在市场发生了最不利极端情况时，如战争、灾害、全球金融危机等因素导致债券大面积违约等情况，该笔投资将可能发生收益达不到预期或本金损失的风险，投资者应当充分认识投资风险，谨慎投资。
    # 其他	贵阳农商银行可根据需要对系统进行优化或升级，并至少于系统优化或升级开始前/完成后2个工作日内通过贵阳农商银行营业网点、官方网站等任一渠道公布。
    # 三、投资管理
    # （一）投资范围
    # 本产品募集资金投资于现金类资产、货币市场工具、货币市场基金、标准化固定收益类资产和其他符合监管要求的资产，具体如下：
    # 1.现金类资产：包括但不限于活期存款、定期存款、协议存款等；
    # 2.货币类资产：同业存单（发行人主体信用评级AA及以上）、期限在一年以内（含一年）的债券回购、货币市场基金；
    # 3.标准化固定收益类资产：包括但不限于国债、中央银行票据、同业存单、金融债、企业债、公司债、中期票据、短期融资券、超短期融资券、定向债务融资工具（PPN）、资产支持证券（ABS）、资产支持票据（ABN）等；
    # 4.符合前述投向的信托计划、资产管理计划；
    # 5.其他符合监管要求的资产。
    # 各类资产的投资比例为：现金类资产、货币类资产、标准化固定收益类资产及符合前述投向的信托计划、资产管理计划的比例为80%-100%；其他符合监管要求的资产0%-20%。
    # 贵阳农商银行秉承价值投资的理念，通过资产组合管理实现本产品安全性、流动性与收益性的平衡。
    # （二）产品管理人、产品托管人、理财投资合作机构的基本信息及主要职责
    # 1.产品管理人：贵阳农村商业银行股份有限公司
    # 主要职责：产品管理人负责理财产品宣传推广，投资者风险承受能力评估和投资者适当性管理，信息披露，理财产品份额认购/申购/赎回，与投资者签订理财产品销售文件，接受投资者的委托和授权，按照本产品说明书约定的投资范围进行投资和资产管理，代表理财产品签订投资和资产管理过程中涉及到的协议、合同等文本。
    # 2.产品托管人：中国工商银行股份有限公司
    # 主要职责：产品托管人主要负责依法依规提供账户开立、财产保管、清算交割、会计核算、资产估值、信息披露、投资监督以及托管合同约定的相关服务。
    # 3.理财投资合作机构
    # 理财投资合作机构包括但不限于理财产品所投资资产管理产品的发行机构、根据合同约定从事理财产品受托投资的机构以及与理财产品投资管理相关的投资顾问等。本理财产品投资合作机构可能包括:鑫沅资产管理有限公司、国民信托有限公司、华创证券有限责任公司、方正富邦基金管理有限公司、厦门国际信托有限公司，产品管理人可根据产品实际运作情况，在符合监管要求的前提下调整理财投资合作机构。
    # 主要职责：理财投资合作机构为进行受托资金的投资管理，根据合同约定从事受托投资或提供投资顾问等服务，具体职责以投资管理人与投资合作机构签署的合同为准。
    # [
    #     {
    #         "chunk_id": "86d7a0ea-a515-49c1-a0f0-4c99abf62a27",
    #         "title": "贵阳农商银行超值宝定开1年8期理财产品介绍",
    #         "summary": "贵阳农商银行推出超值宝定开1年8期理财产品，产品类型为固定收益类，运作方式为开放式，业绩比较基准为2.60%-3.60%/年。目标投资者为稳健型、平衡型、成长型、进取型个人投资者，内部风险评级为二级（较低风险级别）。产品规模上限为40000万元，下限为1000万元。个人投资者起购金额为1万元，单个投资者持有份额不超过2000万元。产品封闭期约为1年，每年2月15日至24日为开放期，投资者可在此期间申购或赎回。产品主要投资于现金类资产、货币类资产、标准化固定收益类资产等，投资比例为80%-100%。",
    #         "propositions": [
    #             "贵阳农村商业银行股份有限公司（以下简称“贵阳农商银行”）自主设计、投资、运作理财产品。",
    #             "购买理财产品前，投资者应仔细阅读理财产品销售文件，包括理财产品说明书、贵阳农商银行理财产品协议书、贵阳农商银行理财产品投资者权益须知、贵阳农商银行风险承受能力评估书、贵阳农商银行理财产品风险揭示书、信息授权书（理财业务版）。",
    #             "投资者应确保自己完全理解该项投资的性质和所涉及的风险，详细了解和审慎评估理财产品的资金投向、风险类型、业绩比较基准等情况。",
    #             "投资者在慎重考虑后自行决定购买与自身风险承受能力和资产管理需求相匹配的理财产品。",
    #             "投资者应随时关注理财产品的信息披露情况，及时获取相关信息。",
    #             "购买理财产品即视为已阅读、理解理财产品销售文件，并同意接受理财产品销售文件所有内容的约束。",
    #             "理财非存款、产品有风险、投资须谨慎。",
    #             "理财产品过往业绩不代表其未来表现，不等于理财产品实际收益，投资须谨慎。",
    #             "产品名称为超值宝定开1年8期理财产品。",
    #             "产品编号为GRCB022024009。",
    #             "产品登记编码为C1188324000013，可在中国理财网上查询产品信息。",
    #             "产品类型为固定收益类。",
    #             "运作方式为开放式。",
    #             "业绩比较基准为2.60%-3.60%/年。",
    #             "业绩比较基准指资产管理人根据市场情况、理财产品运行情况所设定的提取业绩报酬的标准。",
    #             "业绩比较基准不构成对委托财产收益的任何明示、暗示或保证。",
    #             "产品主要投资于现金类资产、货币类资产、货币市场基金、债券型基金、标准化固定收益类资产及符合前述投向的信托计划、资产管理计划，投资比例为80%-100%。",
    #             "业绩比较基准是根据产品的投资范围和周期，综合评估宏观经济环境、债券市场历史趋势、近期利率水平等情况，结合产品投资策略进行测算，扣除销售费、管理费、托管费等所有费用后，综合得到产品业绩比较基准。",
    #             "产品存续期内，贵阳农商银行可根据市场情况调整业绩比较基准，并至少于新的业绩比较基准启用日之前2个工作日进行公告。",
    #             "业绩比较基准不是预期收益率，不代表产品的未来表现和实际收益，不构成对产品收益的承诺。",
    #             "目标投资者为经贵阳农商银行评估为稳健型、平衡型、成长型、进取型的个人投资者。",
    #             "内部风险评级为二级（较低风险级别）。",
    #             "本金及收益币种为人民币。",
    #             "产品规模上限为40000万元，下限为1000万元。",
    #             "贵阳农商银行可根据市场情况调整产品规模上下限。",
    #             "认购是指投资者在产品募集期申请购买理财产品。",
    #             "申购是指投资者在产品开放期申请购买理财产品。",
    #             "本理财产品认购/申购面值为1元/份，即单位初始份额净值为1元/份。",
    #             "个人投资者起购金额为1万元，以1万元的整数倍递增。",
    #             "单个投资者持有份额不超过2000万元，超出部分贵阳农商银行根据实际情况将限制申购。",
    #             "销售渠道为贵阳农商银行营业网点、手机银行等电子渠道。",
    #             "工作日为产品存续期内每一国家法定工作日。",
    #             "封闭期约为1年，每个封闭期运作天数按照实际天数计算。",
    #             "每年2月15日9:00-2月24日16:59为产品开放期，投资者可在该期间进行申购或赎回。",
    #             "若开放期最后一日遇国家法定节假日，则顺延至下一个工作日，若有调整以贵阳农商银行官方公告为准。",
    #             "开放日是指开放期内投资者可以申购、赎回本理财产品的任一日。",
    #             "开放期结束日下一个工作日为产品清算日，投资者赎回金额采用清算日前一工作日产品净值进行确认。",
    #             "产品收益将在清算日后3个工作日内进行收益分配，收益以现金形式分配至投资者账户。",
    #             "兑付日为清算日后的3个工作日内，将对成功申请赎回的份额进行兑付。",
    #             "投资者在开放期内未发起赎回申请的，投资者持有份额将自动进入下一个封闭期，依次循环直至产品到期。",
    #             "在开放期内申请赎回交易的，管理人将统一在清算日进行确认。投资者申请赎回并不代表赎回成功，赎回是否成功以管理人的确认结果为准。",
    #             "赎回份额以1万份的整数倍递增。",
    #             "在市场发生了最不利极端情况时，如战争、灾害、全球金融危机等因素导致债券大面积违约等情况，该笔投资将可能发生收益达不到预期或本金损失的风险，投资者应当充分认识投资风险，谨慎投资。",
    #             "本产品募集资金投资于现金类资产、货币市场工具、货币市场基金、标准化固定收益类资产和其他符合监管要求的资产。",
    #             "现金类资产包括但不限于活期存款、定期存款、协议存款等。",
    #             "货币类资产包括同业存单（发行人主体信用评级AA及以上）、期限在一年以内（含一年）的债券回购、货币市场基金。",
    #             "标准化固定收益类资产包括但不限于国债、中央银行票据、同业存单、金融债、企业债、公司债、中期票据、短期融资券、超短期融资券、定向债务融资工具（PPN）、资产支持证券（ABS）、资产支持票据（ABN）等。",
    #             "符合前述投向的信托计划、资产管理计划及其他符合监管要求的资产。",
    #             "各类资产的投资比例为：现金类资产、货币类资产、标准化固定收益类资产及符合前述投向的信托计划、资产管理计划的比例为80%-100%；其他符合监管要求的资产0%-20%。",
    #             "贵阳农商银行秉承价值投资的理念，通过资产组合管理实现本产品安全性、流动性与收益性的平衡。"
    #         ]
    #     },
    #     {
    #         "chunk_id": "41258be1-c70e-4126-876c-55367bcaabce",
    #         "title": "贵阳农商银行公募理财产品募集公告",
    #         "summary": "贵阳农村商业银行股份有限公司将于2024年2月15日至2月25日进行公募理财产品的募集，成立日为2024年2月26日。产品管理人有权根据市场情况调整募集时间和产品成立日，并通过多种渠道公布相关信息。贵阳农商银行不负责代扣代缴投资者收益税款，但如法律法规要求将依法履行代扣代缴义务。",
    #         "propositions": [
    #             "募集方式为公募。",
    #             "募集期为2024年2月15日-2024年2月25日。",
    #             "产品管理人有权根据市场情况提前结束或延长产品募集时间并相应调整产品成立日。",
    #             "成立日为2024年2月26日。",
    #             "贵阳农商银行有权提前结束募集并成立产品，成立产品当天通过贵阳农商银行营业网点、官方网站等任一渠道公布。",
    #             "贵阳农商银行暂不负责代扣代缴投资者购买本产品所得收益应缴纳的各项税款。",
    #             "若相关法律法规、税收政策规定产品管理人应代扣代缴相关税款，贵阳农商银行有权依法履行代扣代缴义务。",
    #             "产品管理人为贵阳农村商业银行股份有限公司，主要职责包括产品宣传推广，投资者风险承受能力评估和投资者适当性管理，信息披露，理财产品份额认购/申购/赎回，与投资者签订理财产品销售文件，接受投资者的委托和授权，按照本产品说明书约定的投资范围进行投资和资产管理，代表理财产品签订投资和资产管理过程中涉及到的协议、合同等文本。"
    #         ]
    #     },
    #     {
    #         "chunk_id": "9648845a-5271-4fbf-92b6-d4f77705ff68",
    #         "title": "贵阳农商银行产品提前终止条款",
    #         "summary": "本期产品期限为20年，但贵阳农商银行有权根据提前终止条款，在提前2个工作日通知后结束产品。通知将通过银行营业网点或官方网站发布。",
    #         "propositions": [
    #             "本期产品期限为20年，实际产品期限受制于提前终止条款。",
    #             "贵阳农商银行有权提前终止产品。提前终止产品时，将至少于提前终止日之前2个工作日内通过贵阳农商银行营业网点、官方网站等任一渠道公布。"
    #         ]
    #     },
    #     {
    #         "chunk_id": "46084eac-fc9b-4894-92d9-9afe62efca4e",
    #         "title": "理财产品单位净值计算规则",
    #         "summary": "本产品到期资金根据持有份额与到期日产品单位净值计算，净值由资产管理人在每个估值日根据投资资产市场价格扣除成本费用后得出，每周前2个工作日公布上周最后一个工作日的单位净值。产品开放期结束或提前终止后2个工作日内发布相应日期的单位净值，计算结果均按四舍五入原则保留小数点后4位。",
    #         "propositions": [
    #             "本产品到期资金=持有份额×到期日产品单位净值（到期资金按四舍五入原则，保留至小数点后2位）。",
    #             "理财产品单位净值是指理财产品净资产除以理财产品总份额得出的每份理财产品当日价值。",
    #             "资产管理人每个估值日根据对应产品所投资资产市场价格计算产品总资产价值，并扣除各类成本及费用后，除以理财产品当前总份额，即为理财产品单位净值，净值的计算按四舍五入原则保留到小数点后第四位。",
    #             "本产品存续期内，每周前2个工作日内公布截至上周最后一个工作日产品单位净值。",
    #             "产品开放期结束或提前终止后，在产品开放期结束或提前终止日（如遇非工作日，则顺延至下一个工作日）后的2个工作日内发布产品收益分配日或提前终止日的产品单位净值。",
    #             "产品单位净值的计算按照四舍五入原则，保留至小数点后4位。"
    #         ]
    #     },
    #     {
    #         "chunk_id": "475ff76d-4aba-410a-b82d-848867ec719d",
    #         "title": "理财产品预约赎回规则说明",
    #         "summary": "本产品设有预约赎回期，投资者可在期间提出或撤销预约赎回申请，赎回申请将在清算日统一处理。若单日净赎回份额超过上一工作日产品总份额10%，则视为巨额赎回，管理人可根据情况拒绝超额部分的赎回请求。连续发生巨额赎回时，管理人有权进一步限制赎回并延长赎回款项支付时间，最长不超过15个工作日。",
    #         "propositions": [
    #             "预约赎回期为整个产品封闭期。",
    #             "本产品设置预约赎回期，投资者可在此期间发起预约赎回申请及撤销预约赎回申请，预约赎回将统一在清算日生效，并确认赎回份额，且确认赎回份额适用巨额赎回的规则。",
    #             "净赎回份额是指投资者赎回申请份额总数扣除申购申请份额总数后的份额。",
    #             "巨额赎回是指理财产品单个开放日净赎回份额申请超过前一日终理财产品总份额10%的赎回行为。",
    #             "发生巨额赎回时，管理人有权依照时间优先原则，拒绝超过理财产品净赎回份额10%以上部分的赎回申请，被拒绝的投资者可于开放期内下一开放日重新提交赎回申请。",
    #             "若理财产品连续2个开放日（含）及以上发生巨额赎回，管理人有权依照时间优先原则，拒绝超过理财产品净赎回份额10%以上部分的赎回申请，投资者可于开放期内下一开放日重新提交赎回申请。",
    #             "对于已经接受的赎回申请，管理人有权延缓支付赎回款项，延缓期限自理财产品兑付日起不超过15个工作日。",
    #             "如开放期最后一日发生巨额赎回情形，管理人有权根据实际情况决定是否接受赎回申请，如接受赎回申请的，管理人有权自理财产品兑付日起不超过15个工作日支付赎回款项。"
    #         ]
    #     },
    #     {
    #         "chunk_id": "bf6df365-126e-4bb8-b55f-24a6d0cec857",
    #         "title": "贵阳农商银行系统优化升级通知",
    #         "summary": "贵阳农商银行将根据需求对系统进行优化或升级，并承诺在操作开始前或完成后两个工作日内，通过其营业网点或官方网站等渠道向公众发布通知。",
    #         "propositions": [
    #             "贵阳农商银行可根据需要对系统进行优化或升级，并至少于系统优化或升级开始前/完成后2个工作日内通过贵阳农商银行营业网点、官方网站等任一渠道公布。"
    #         ]
    #     },
    #     {
    #         "chunk_id": "6bcb5e35-f20a-4c68-8e68-61d0c5f3cccc",
    #         "title": "工商银行产品托管服务简介",
    #         "summary": "中国工商银行作为产品托管人，提供包括账户开立、财产保管、清算交割、会计核算、资产估值、信息披露及投资监督等在内的多项服务，确保业务操作依法合规。",
    #         "propositions": [
    #             "产品托管人为中国工商银行股份有限公司，主要职责包括依法依规提供账户开立、财产保管、清算交割、会计核算、资产估值、信息披露、投资监督以及托管合同约定的相关服务。"
    #         ]
    #     },
    #     {
    #         "chunk_id": "55e7ce2a-0977-47a0-b538-7a0b89e03405",
    #         "title": "理财投资合作机构概览",
    #         "summary": "理财产品的投资合作机构涵盖资产管理产品发行机构、受托投资机构及投资顾问等，具体包括鑫沅资产管理有限公司、国民信托有限公司、华创证券有限责任公司等。这些机构依据合同约定执行受托投资或提供顾问服务，且可根据产品运作情况及监管要求适时调整。",
    #         "propositions": [
    #             "理财投资合作机构包括但不限于理财产品所投资资产管理产品的发行机构、根据合同约定从事理财产品受托投资的机构以及与理财产品投资管理相关的投资顾问等。",
    #             "本理财产品投资合作机构可能包括：鑫沅资产管理有限公司、国民信托有限公司、华创证券有限责任公司、方正富邦基金管理有限公司、厦门国际信托有限公司，产品管理人可根据产品实际运作情况，在符合监管要求的前提下调整理财投资合作机构。",
    #             "理财投资合作机构为进行受托资金的投资管理，根据合同约定从事受托投资或提供投资顾问等服务，具体职责以投资管理人与投资合作机构签署的合同为准。"
    #         ]
    #     }
    # ]
    # 程序运行时间：672.6466732025146秒