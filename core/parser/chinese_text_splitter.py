import re
from typing import List, Callable

from parser.agentic_chunking import ChunkOrganizer

WHITESPACE_RE = re.compile(
    r"[ \t\u3000\x0b\x0c\r]+"  # 半角/全角空格、Tab、VT、FF、CR
)

_SOFT_BREAK = re.compile(r'(?<![。！？!?])\n(?!\n)')


def unwrap_soft_break(text: str) -> str:
    """把 PDF 强制换行合并成空格"""
    return _SOFT_BREAK.sub(' ', text)


# 预处理：把所有 “看不见的空白” 压成普通换行
def normalize_blanklines(text: str) -> str:
    text = WHITESPACE_RE.sub(" ", text)  # 先统一成普通空格，保留行内空格
    text = text.replace("\u2029", "\n")  # 段落分隔符
    # 压缩 >=4 连续换行 → 两个换行
    return re.sub(r"(?:\n\s*){4,}", "\n\n", text)


# ========= 1) 原子切分器工厂 ========= #
def char_split(text: str) -> List[str]:
    return list(text)


_SENT_END = re.compile(r'[^。！？!?\.]*?(?:[。！？!?]|(?<!\d)\.(?!\d))')


def sentence_split(text: str) -> List[str]:
    text = unwrap_soft_break(text)
    text = WHITESPACE_RE.sub(' ', text)
    sentences = [m.group(0).strip() for m in _SENT_END.finditer(text)]
    if not sentences:  # 全文没句尾 → 整段返回
        sentences = [text.strip()]
    return sentences


def paragraph_split(text: str) -> list[str]:
    text = text.replace("\r\n", "\n").replace("\r", "\n")
    text = normalize_blanklines(text)
    # 1) 按 >=2 换行切；允许行首有空白
    pieces = re.split(r"(?:\n\s*){2,}", text)
    # 2) 仅保留“含任意非空白字符”的段落
    return [p.strip() for p in pieces if re.search(r"\S", p)]


SPLITTERS: dict[str, Callable[[str], List[str]]] = {
    "char": char_split,
    "sentence": sentence_split,
    "paragraph": paragraph_split,
}


# ========= 2) 通用递归分割器 ========= #
class FlexibleRecursiveSplitter:
    def __init__(
            self,
            granularity: str = "sentence",
            chunk_size: int = 200,
            overlap_units: int = 2,
            char_separators: List[str] | None = None,
    ):
        if granularity not in SPLITTERS:
            raise ValueError(f"granularity must be one of {list(SPLITTERS)}")
        self.split_fn = SPLITTERS[granularity]
        self.granularity = granularity
        self.chunk_size = chunk_size
        self.overlap_units = overlap_units
        self.char_separators = char_separators or ["\n\n", "\n", " ", None]

    # ---- 主入口 ---- #
    def split(self, text: str) -> List[str]:
        units = self.split_fn(text)
        return self._assemble(units)

    def _join_units(self, units: List[str]) -> str:
        # char 粒度直接拼；其它粒度在单位之间补一个空格
        glue = '' if self.granularity == 'char' else ' '
        return glue.join(units)

    # ---- 组块 + 重叠 ---- #
    def _assemble(self, units: list[str]) -> list[str]:
        chunks, buf, buf_len = [], [], 0
        for u in units:
            u_len = len(u)

            # ---------- A. 超长原子 ----------
            if u_len > self.chunk_size:
                # ① flush 正常缓冲（保留句/段重叠）
                if buf:
                    chunks.append(self._join_units(buf))
                    buf, buf_len = [], 0

                # ② 用 smart_split / 旧 _char_recursive_split 拆超长 u
                parts = self._smart_split(u)  # ← 或 self._char_recursive_split(u)

                if self.overlap_units and len(parts) > 1:
                    # ③ 前缀/后缀：取 u 首尾 overlap_units 个「字符」
                    #    - granularity == 'char'  → 刚好是字符级
                    #    - sentence/paragraph    → 只是补一点上下文 glue，不会破坏单位数统计
                    prefix = u[:self.overlap_units]
                    suffix = u[-self.overlap_units:]
                    parts[0] = prefix + parts[0]
                    parts[-1] = parts[-1] + suffix

                chunks.extend(parts)
                continue

            # ---------- B. 正常累积 ----------
            extra = 0 if not buf or self.granularity == 'char' else 1
            if buf_len + u_len + extra <= self.chunk_size:
                buf.append(u)
                buf_len += u_len + extra
            else:
                chunks.append(self._join_units(buf))
                buf = buf[-self.overlap_units:] if self.overlap_units else []
                buf_len = sum(len(x) + (0 if i == 0 or self.granularity == 'char' else 1)
                              for i, x in enumerate(buf))
                extra = 0 if not buf or self.granularity == 'char' else 1
                buf.append(u)
                buf_len += u_len + extra

        if buf:
            chunks.append(self._join_units(buf))
        return [c for c in chunks if c.strip()]

    # ---- 字符级递归，沿用 LangChain 思路 加阈值：只有“分出来的片段平均长度仍大于阈”才继续递归---- #
    def _char_recursive_split(self, text: str, seps: List[str] | None = None):
        seps = seps or self.char_separators
        if len(text) <= self.chunk_size or not seps:
            return [text]

        # 兜底仍保持硬切
        if seps[0] is None:
            return [text[i:i + self.chunk_size] for i in range(0, len(text), self.chunk_size)]

        # 尝试分隔
        pieces = text.split(seps[0])
        #   a) 分隔符无效  b) 分出太多碎片(平均 < 1/3 chunk) → 换下一级
        if len(pieces) == 1 or (len(text) / len(pieces) < self.chunk_size // 3):
            return self._char_recursive_split(text, seps[1:])

        out = []
        for p in pieces:
            out.extend(self._char_recursive_split(p, seps[1:]))
        return out

    # 找离 chunk_size 最近的右侧分隔符
    def _smart_split(self, text: str) -> List[str]:
        if len(text) <= self.chunk_size:
            return [text]

        seps = ["\n\n", "\n", " ", ""]  # 最后一项空串 = 硬切
        char_overlap = self.overlap_units if self.granularity == 'char' else 0
        stride = self.chunk_size - char_overlap if char_overlap < self.chunk_size else self.chunk_size

        start, chunks = 0, []
        while start < len(text):
            window_end = min(start + self.chunk_size, len(text))
            cut = None
            for sep in seps:
                idx = text.rfind(sep, start, window_end)
                if idx != -1 and idx > start:
                    cut = idx + len(sep)
                    break
            if cut is None or cut == start:  # 找不到断点 → 硬切
                cut = window_end

            chunks.append(text[start:cut])
            start += stride  # ← 关键：窗口带重叠滑动
        return chunks


if __name__ == "__main__":
    txt = """香港交易及結算所有限公司及香港聯合交易所有限公司對本公告的內容概不負責，對其準確性
或完整性亦不發表任何聲明，並明確表示概不就因本公告全部或任何部分內容而產生或因倚賴
該等內容而引致的任何損失承擔任何責任。
比亞迪股份有限公司
BYD COMPANY LIMITED
（在中華人民共和國註冊成立的股份有限公司）
（股份代號：1211）
網站：http://www.bydglobal.com
二零二二年第三季度報告
本公告在中華人民共和國境內和香港同步刊登。本公告根據《深圳證券交易所股
票上市規則》的規定在境內刊登，根據《香港聯合交易所有限公司證券上市規則》
第13.09條及第13.10B條以及證券及期貨條例（香港法例第571章）第XIVA部之內
幕消息條文的披露義務而在香港公佈。
重要內容提示：
1. 董事會、監事會及董事、監事、高級管理人員保證季度報告的真實、準確、
完整，不存在虛假記載、誤導性陳述或重大遺漏，並承擔個別和連帶的法律
責任。
2. 公司負責人、主管會計工作負責人及會計機構負責人（會計主管人員）聲明：
保證季度報告中財務信息的真實、準確、完整。
3. 第三季度報告是否經過審計
□ 是　✓ 否
1
2
一、一、 主要財務數據 主要財務數據
（一） 主要會計數據和財務指標 主要會計數據和財務指標
公司是否需追溯調整或重述以前年度會計數據
□ 是　✓ 否
本報告期
本報告期
比上年
同期增減
年初至
報告期末
年初至報告
期末比上年
同期增減
營業收入（人民幣元） 117,080,595,000.00 115.59% 267,687,847,000.00 84.37%
歸屬於上市公司股東的淨利潤
（人民幣元） 5,716,188,000.00 350.26% 9,311,467,000.00 281.13%
歸屬於上市公司股東的扣除非經常性損
益的淨利潤（人民幣元） 5,335,217,000.00 930.48% 8,364,627,000.00 843.66%
經營活動產生的現金流量淨額
（人民幣元） – – 91,036,733,000.00 185.62%
基本每股收益（人民幣元╱股） 1.97 347.73% 3.20 276.47%
稀釋每股收益（人民幣元╱股） 1.97 347.73% 3.20 276.47%
加權平均淨資產收益率 5.74% 4.19% 9.43% 6.37%
本報告期末 上年度末
本報告期末
比上年度末
增減
總資產（人民幣元） 426,230,852,000.00 295,780,147,000.00 44.10%
歸屬於上市公司股東的所有者權益
（人民幣元） 102,513,686,000.00 95,069,671,000.00 7.83%
3
（二） 非經常性損益項目和金額 非經常性損益項目和金額
✓ 適用　□ 不適用
單位：人民幣元
項目
本報告期
金額
年初至報告期期
末金額 說明
非流動資產處置損益
（包括已計提資產減值準備的沖銷部分）
-46,695,000.00 -174,972,000.00
計入當期損益的政府補助（與公司正常經營業務密
切相關，符合國家政策規定、按照一定標準定額
或定量持續享受的政府補助除外）
501,745,000.00 1,139,902,000.00 主要是與汽車
及汽車相關
產品有關的
政府補助
委託他人投資或管理資產的損益 127,570,000.00 226,027,000.00
除同公司正常經營業務相關的有效套期保值業務
外，持有交易性金融資產、交易性金融負債產生
的公允價值變動損益，以及處置交易性金融資
產、交易性金融負債和可供出售金融資產取得的
投資收益
-150,389,000.00 -218,650,000.00
單獨進行減值測試的應收款項減值準備轉回 1,410,000.00 37,096,000.00
根據稅收，會計等法律，法規的要求對當期損益
進行一次性調整對當期損益的影響
– -11,068,000.00
除上述各項之外的其他營業外收入和支出 63,178,000.00 186,016,000.00
減：所得稅影響額 90,149,000.00 185,003,000.00
少數股東權益影響額（稅後） 25,699,000.00 52,508,000.00
合計 380,971,000.00 946,840,000.00
其他符合非經常性損益定義的損益項目的具體情況：
□ 適用　✓ 不適用
公司不存在其他符合非經常性損益定義的損益項目的具體情況。
將《公開發行證券的公司信息披露解釋性公告第1號－非經常性損益》中列舉
的非經常性損益項目界定為經常性損益項目的情況說明
□ 適用　✓ 不適用
公司不存在將《公開發行證券的公司信息披露解釋性公告第1號－非經常性損
益》中列舉的非經常性損益項目界定為經常性損益的項目的情形。
4
5
（三） 主要會計數據和財務指標發生變動的情況及原因 主要會計數據和財務指標發生變動的情況及原因
✓ 適用 □ 不適用
資產負債表
單位：人民幣元
科目名稱 2022-9-30 2021-12-31 變動率 變動原因
交易性金融資產 2,442,014,000.00 5,606,052,000.00 -56.44% 主要是理財產品
到期所致
預付款項 6,064,295,000.00 2,036,577,000.00 197.77% 主要是預付貨款
增加所致
存貨 73,454,508,000.00 43,354,782,000.00 69.38% 主要是新能源汽
車業務增加所致
合同資產 11,810,129,000.00 8,493,382,000.00 39.05% 主要是新能源汽
車業務銷售增加
所致
一年內到期的長期應收款 749,278,000.00 1,231,667,000.00 -39.17% 主要是分期收款
銷售商品回款增
加所致
其他流動資產 27,379,911,000.00 8,525,475,000.00 221.15% 主要是大額存單
增加所致
長期股權投資 13,377,049,000.00 7,905,001,000.00 69.22% 主要是對合營公
司投資增加所致
其他非流動金融資產 1,654,117,000.00 233,972,000.00 606.97% 主要是對外投資
增加所致
固定資產 101,340,045,000.00 61,221,365,000.00 65.53% 主要是電池、汽
車業務投資增加
所致
6
科目名稱 2022-9-30 2021-12-31 變動率 變動原因
在建工程 38,947,932,000.00 20,277,309,000.00 92.08% 主要是電池、汽
車業務投資增加
所致
使用權資產 2,535,154,000.00 1,573,232,000.00 61.14% 主要是新能源汽
車業務增加所致
無形資產 22,851,456,000.00 17,104,942,000.00 33.60% 主要是土地購置
增加所致
遞延所得稅資產 2,929,014,000.00 1,913,316,000.00 53.09% 主要是可抵扣暫
時性差異增加所
致
其他非流動資產 19,085,158,000.00 12,521,050,000.00 52.42% 主要是電池、汽
車業務投資增加
所致
應付票據 2,637,935,000.00 7,331,459,000.00 -64.02% 主要是本期結算
方式變更所致
應付賬款 119,212,636,000.00 73,160,167,000.00 62.95% 主要是新能源汽
車業務增加，材
料採購增加所致
合同負債 33,522,255,000.00 14,932,576,000.00 124.49% 主要是預收貨款
增加所致
應付職工薪酬 8,813,122,000.00 5,848,870,000.00 50.68% 主要是人員增加
導致工資計提增
加所致
應交稅費 3,583,684,000.00 1,779,018,000.00 101.44% 主要是本期所得
稅計提增加所致
7
科目名稱 2022-9-30 2021-12-31 變動率 變動原因
其他應付款 94,906,616,000.00 41,348,102,000.00 129.53% 主要是電池、汽
車業務投資增加
所致
預計負債 5,776,670,000.00 2,355,564,000.00 145.24% 主要是新能源汽
車業務銷售增加
所致
一年內到期的非流動負債 6,723,515,000.00 12,983,416,000.00 -48.21% 主要是本期償還
債券與借款所致
其他流動負債 2,781,339,000.00 1,359,114,000.00 104.64% 主要是待轉銷項
稅增加所致
應付債券 – 2,046,439,000.00 -100.00% 主要是轉出未來
一年內到期的應
付債券所致
租賃負債 2,059,260,000.00 1,415,291,000.00 45.50% 主要是新能源汽
車業務增加所致
遞延所得稅負債 1,078,517,000.00 609,566,000.00 76.93% 主要是應納稅暫
時性差異增加所
致
8
損益表
單位：人民幣元
科目名稱 2022 2022年年1-9 1-9月月 2021 2021年年1-9 1-9月月 變動率 變動原因
營業收入 267,687,847,000.00 145,192,358,000.00 84.37% 主要是新能源汽
車業務增加所致
營業成本 225,146,947,000.00 126,353,739,000.00 78.19% 主要是銷售規模
增加所致
稅金及附加 4,462,138,000.00 1,769,060,000.00 152.23% 主要是本期消費
稅增加所致
銷售費用 9,355,972,000.00 4,258,573,000.00 119.70% 主要是售後服務
費和職工薪酬增
加所致
管理費用 6,409,600,000.00 3,783,509,000.00 69.41% 主要是職工薪酬
增加所致
研究及開發費用 10,870,017,000.00 5,233,772,000.00 107.69% 主要是職工薪酬
及物料消耗增加
所致
財務費用 -1,339,678,000.00 1,371,908,000.00 -197.65% 主要是利息收入
與匯兌收益增加
所致
投資收益（損失以「-」號填列） -332,052,000.00 -28,291,000.00 1,073.70% 主要是對合營公
司投資損失增加
所致
9
科目名稱 2022 2022年年1-9 1-9月月 2021 2021年年1-9 1-9月月 變動率 變動原因
公允價值變動收益（損失以
「-」號填列）
-47,564,000.00 57,196,000.00 -183.16% 主要是遠期購結
匯業務變動、對
外投資公司估值
變動所致
信用減值損失（損失以
「-」號填列）
-548,525,000.00 -106,378,000.00 415.64% 主要是壞賬準備
計提增加所致
資產減值損失（損失以
「-」號填列）
-898,693,000.00 -239,613,000.00 275.06% 主要是存貨、開
發支出及無形資
產減值計提增加
所致
資產處置收益（損失以
「-」號填列）
-21,566,000.00 256,606,000.00 -108.40% 主要是處置資產
產生的損失所致
所得稅費用 2,130,753,000.00 629,913,000.00 238.26% 主要是本期盈利
增加所致
現金流量表
單位：人民幣元
科目名稱 2022 2022年年1-9 1-9月月 2021 2021年年1-9 1-9月月 變動率 變動原因
經營活動產生的現金流量淨額 91,036,733,000.00 31,873,711,000.00 185.62% 主要是本期銷售
商品、提供勞務
收到的現金增加
所致
投資活動產生的現金流量淨額 -83,657,427,000.00 -22,289,539,000.00 275.32% 主要是本期購建
固定資產、無形
資產和其他長期
資產支付的現金
增加所致
籌資活動產生的現金流量淨額 -15,997,988,000.00 9,345,538,000.00 -271.18% 主要是上期增發
境外上市外資股
（H股）所致
現金及現金等價物淨增加額 -8,193,681,000.00 18,921,164,000.00 -143.30%
10
二、二、 股東信息 股東信息
（一） 普通股股東總數和表決權恢復的優先股股東數量及前十名股東持股情況表 普通股股東總數和表決權恢復的優先股股東數量及前十名股東持股情況表
單位：股
報告期末普通股股東總數
324,853 324,853（其中 （其中AA股股東 股股東
為為324,741 324,741戶，戶，HH股股東為 股股東為112 112戶）戶） 報告期末表決權恢復的優先股股東總數 0
前前1010名股東持股情況 名股東持股情況
股東名稱 股東性質 持股比例 持股數量
持有有限售
條件的
股份數量
質押、標記或凍結情況
股份狀態 數量
HKSCC NOMINEES LIMITED 境外法人 37.70% 1,097,450,757
（註1）
0
王傳福 境內自然人 17.64% 513,623,850
（註2）
385,217,887
呂向陽 境內自然人 8.22% 239,228,620 179,421,465 質押 40,880,000
融捷投資控股集團有限公司 境內非國有法人 5.30% 154,426,602 0 質押 20,654,924
夏佐全 境內自然人 2.84% 82,635,607
（註3）
61,976,705
香港中央結算有限公司 境外法人 2.44% 71,116,231 0
王念強 境內自然人 0.63% 18,299,740 0 質押 2,705,000
中央匯金資產管理有限責任公司 國有法人 0.41% 11,976,633 0
李柯 境內自然人 0.38% 10,921,400 8,191,050 質押 5,319,633
王傳方 境內自然人 0.30% 8,824,680 6,618,510
註1： HKSCC NOMINEES LIMITED所持股份為其代理的在HKSCC NOMINEES 
LIMITED交易平台上交易的本公司H股股東賬戶的股份總和。此數包括王傳福先
生持有的1,000,000股H股和夏佐全先生及其控股的海外公司SIGN INVESTMENTS 
LIMITED分別持有的195,000股H股和305,000股H股；也包括本報告期WESTERN 
CAPITAL GROUP LLC（係原名為MIDAMERICAN ENERGY HOLDINGS 
COMPANY的BERKSHIRE HATHAWAY ENERGY COMPANY 100%控制的公司）
持有的股份轉為HKSCC NOMINEES LIMITED代理的H股；
註2：此數不包括王傳福先生持有的1,000,000股H股；此數不包括王傳福先生通過易方
達資產比亞迪增持1號資產管理計劃持有的3,727,700股A股；
註3：此數不包括夏佐全先生及其控股的海外公司SIGN INVESTMENTS LIMITED分別
持有的195,000股H股和305,000股H股。
11
前前1010名無限售條件股東持股情況 名無限售條件股東持股情況
股東名稱
持有無限售條件
股份數量
股份種類
股份種類 數量
HKSCC NOMINEES LIMITED 1,097,450,757 境外上市外資股 1,097,450,757
融捷投資控股集團有限公司 154,426,602 人民幣普通股 154,426,602
王傳福 128,405,963 人民幣普通股 128,405,963
香港中央結算有限公司 71,116,231 人民幣普通股 71,116,231
呂向陽 59,807,155 人民幣普通股 59,807,155
夏佐全 20,658,902 人民幣普通股 20,658,902
王念強 18,299,740 人民幣普通股 18,299,740
中央匯金資產管理有限責任公司 11,976,633 人民幣普通股 11,976,633
上海高毅資產管理合夥企業（有
限合夥）－高毅曉峰2號致信
基金 7,539,964 人民幣普通股 7,539,964
全國社保基金一一四組合 7,216,300 人民幣普通股 7,216,300
上述股東關聯關係或一致行動的
說明
1、王傳福先生是本公司的控股股東及實際控制人；
呂向陽先生為王傳福先生之表兄，呂向陽先生及其配
偶張長虹女士分別持有融捷投資控股集團有限公司
89.5%和10.5%的股權；
2、HKSCC NOMINEES LIMITED所持股份為其代理
的在HKSCC NOMINEES LIMITED交易平台上交易的
本公司H股股東賬戶的股份總和；
3、公司未知其他股東之間是否存在關聯關係或屬於
《上市公司收購管理辦法》規定的一致行動人。
前 10名股東參與融資融券業務
情況說明
報告期內公司股東融捷投資控股集團有限公司參與了
轉融通證券出借業務，截至報告期末共涉及股份數量
723,000股A股，該轉融通證券出借股份所有權不會發
生轉移，其實際持股數量共計155,149,602股A股。
（二） 公司優先股股東總數及前10名優先股股東持股情況表
□ 適用　✓ 不適用
12
三、 其他重要事項
✓ 適用　□ 不適用
公司於2022年4月22日召開了第七屆董事會第二十一次會議及第七屆監事會
第九次會議，並於2022年5月27日召開了2022年第一次臨時股東大會，審議
通過了《關於審議<比亞迪股份有限公司2022年員工持股計劃（草案）>及其摘
要的議案》及《關於審議<比亞迪股份有限公司2022年員工持股計劃管理辦法
>的議案》等相關議案。具體內容詳見公司分別於2022年4月23日、2022年5
月28日及2022年5月30日在巨潮資訊網(www.cninfo.com.cn)上披露的《第七
屆董事會第二十一次會議決議公告》（公告編號：2022-053）、《比亞迪股份有
限公司2022年員工持股計劃（草案）》及其摘要、《比亞迪股份有限公司2022
年員工持股計劃管理辦法》及《2022年第一次臨時股東大會決議公告》（公告
編號：2022-080）以及《比亞迪股份有限公司2022年員工持股計劃》（以下簡
稱「本次員工持股計劃」）。本次員工持股計劃參與對象包括公司的職工代表
監事、高級管理人員以及比亞迪集團的中層管理人員、核心骨幹員工，參與
本員工持股計劃的總人數不超過12,000人，本次員工持股計劃將通過非交易
過戶等法律法規允許的方式受讓公司擬回購的公司股票，受讓價格為0元 ╱
股，參與對象無需出資。
截至2022年6月13日，公司通過回購專用證券賬戶以集中競價交易的方式
累計回購A股股份的數量為5,511,024股，佔公司總股本的0.189%，最高成
交價為人民幣358.58元╱股，最低成交價為人民幣293.37元╱股，回購資
金總額為人民幣1,809,702,398.72元（不含交易費用），完成了本次員工持股
計劃所需的股份回購。具體內容詳見公司於2022年6月15日在巨潮資訊網
(www.cninfo.com.cn)上披露的《關於2022年回購公司股份的方案實施完畢的
公告》（公告編號：2022-092）。
公司於2022年7月14日收到中國證券登記結算有限責任公司深圳分公司出具
的《證券過戶登記確認書》，公司回購專用證券賬戶所持有的5,511,024股公司
股票已以非交易過戶形式過戶至本次員工持股計劃專用證券賬戶。具體內容
詳見公司於2022年7月15日在巨潮資訊網( www.cninfo.com.cn)上披露的《關於
2022年員工持股計劃完成非交易過戶的公告》（公告編號：2022-104）。
本次員工持股計劃於2022年9月16日召開了第一次持有人會議，審議通過了
《關於設立比亞迪股份有限公司2022年員工持股計劃管理委員會的議案》、
《關於選舉比亞迪股份有限公司2022年員工持股計劃管理委員會委員的議案》
和《關於授權比亞迪股份有限公司2022年員工持股計劃管理委員會辦理本次
員工持股計劃相關事宜的議案》，具體內容詳見公司於2022年9月17日在巨潮
資訊網( www.cninfo.com.cn)上披露的《2022年員工持股計劃第一次持有人會
議決議公告》（公告編號：2022-120）。
13
14
四、四、 季度財務報表 季度財務報表
（一） 財務報表 財務報表
11、、 合併資產負債表 合併資產負債表
編製單位：比亞迪股份有限公司
2022 2022年年0909月月3030日日
單位：人民幣元
項目 2022 2022年年99月月3030日日 2021 2021年年1212月月3131日日
流動資產：
　貨幣資金 44,932,061,000.00 50,457,097,000.00
　交易性金融資產 2,442,014,000.00 5,606,052,000.00
　應收賬款 36,968,493,000.00 36,251,280,000.00
　應收款項融資 10,213,413,000.00 8,743,126,000.00
　預付款項 6,064,295,000.00 2,036,577,000.00
　其他應收款 2,329,828,000.00 1,410,751,000.00
　　其中：應收利息 136,569,000.00
　　　　　應收股利
　存貨 73,434,508,000.00 43,354,782,000.00
　合同資產 11,810,129,000.00 8,493,382,000.00
　一年內到期的非流動資產 749,278,000.00 1,231,667,000.00
　其他流動資產 27,379,911,000.00 8,525,475,000.00
流動資產合計 216,323,930,000.00 166,110,189,000.00
15
四、四、 季度財務報表（續） 季度財務報表（續）
（一） 財務報表（續） 財務報表（續）
11、、 合併資產負債表（續） 合併資產負債表（續）
編製單位：比亞迪股份有限公司
2022 2022年年0909月月3030日日
單位：人民幣元
項目 2022 2022年年99月月3030日日 2021 2021年年1212月月3131日日
非流動資產：
　長期應收款 1,106,195,000.00 1,170,058,000.00
　長期股權投資 13,377,049,000.00 7,905,001,000.00
　其他權益工具投資 3,486,613,000.00 2,913,836,000.00
　其他非流動金融資產 1,654,117,000.00 233,972,000.00
　投資性房地產 85,628,000.00 87,500,000.00
　固定資產 101,340,045,000.00 61,221,365,000.00
　在建工程 38,947,932,000.00 20,277,309,000.00
　使用權資產 2,535,154,000.00 1,573,232,000.00
　無形資產 22,851,456,000.00 17,104,942,000.00
　開發支出 2,192,636,000.00 2,605,031,000.00
　商譽 65,914,000.00 65,914,000.00
　長期待攤費用 250,011,000.00 77,432,000.00
　遞延所得稅資產 2,929,014,000.00 1,913,316,000.00
　其他非流動資產 19,085,158,000.00 12,521,050,000.00
非流動資產合計 209,906,922,000.00 129,669,958,000.00
資產總計 426,230,852,000.00 295,780,147,000.00
16
四、四、 季度財務報表（續） 季度財務報表（續）
（一） 財務報表（續） 財務報表（續）
11、、 合併資產負債表（續） 合併資產負債表（續）
編製單位：比亞迪股份有限公司
2022 2022年年0909月月3030日日
單位：人民幣元
項目 2022 2022年年99月月3030日日 2021 2021年年1212月月3131日日
流動負債：
　短期借款 9,513,343,000.00 10,204,358,000.00
　交易性金融負債 173,767,000.00
　應付票據 2,637,935,000.00 7,331,459,000.00
　應付賬款 119,212,636,000.00 73,160,167,000.00
　預收款項 0.00 1,300,000.00
　合同負債 33,522,255,000.00 14,932,576,000.00
　應付職工薪酬 8,813,122,000.00 5,848,870,000.00
　應交稅費 3,583,684,000.00 1,779,018,000.00
　其他應付款 94,906,616,000.00 41,348,102,000.00
　　其中：應付利息
　　　　　應付股利
　預計負債 5,776,670,000.00 2,355,564,000.00
　一年內到期的非流動負債 6,723,515,000.00 12,983,416,000.00
　其他流動負債 2,781,339,000.00 1,359,114,000.00
流動負債合計 287,644,882,000.00 171,303,944,000.00
17
四、四、 季度財務報表（續） 季度財務報表（續）
（一） 財務報表（續） 財務報表（續）
11、、 合併資產負債表（續） 合併資產負債表（續）
編製單位：比亞迪股份有限公司
2022 2022年年0909月月3030日日
單位：人民幣元
項目 2022 2022年年99月月3030日日 2021 2021年年1212月月3131日日
非流動負債：
　長期借款 7,755,968,000.00 8,743,519,000.00
　應付債券 0.00 2,046,439,000.00
　　其中：優先股
　　　　　永續債
　租賃負債 2,059,260,000.00 1,415,291,000.00
　遞延所得稅負債 1,078,517,000.00 609,566,000.00
　其他非流動負債 15,127,997,000.00 7,417,179,000.00
非流動負債合計 26,021,742,000.00 20,231,994,000.00
負債合計 313,666,624,000.00 191,535,938,000.00
所有者權益：
　股本 2,911,143,000.00 2,911,143,000.00
　資本公積 61,265,290,000.00 60,807,219,000.00
　減：庫存股 1,809,920,000.00
　其他綜合收益 -338,599,000.00 -124,055,000.00
18
四、四、 季度財務報表（續） 季度財務報表（續）
（一） 財務報表（續） 財務報表（續）
11、、 合併資產負債表（續） 合併資產負債表（續）
編製單位：比亞迪股份有限公司
2022 2022年年0909月月3030日日
單位：人民幣元
項目 2022 2022年年99月月3030日日 2021 2021年年1212月月3131日日
　專項儲備 14,980,000.00 10,369,000.00
　盈餘公積 5,009,088,000.00 5,009,088,000.00
　未分配利潤 35,461,704,000.00 26,455,907,000.00
歸屬於母公司所有者權益合計 102,513,686,000.00 95,069,671,000.00
　少數股東權益 10,050,542,000.00 9,174,538,000.00
所有者權益合計 112,564,228,000.00 104,244,209,000.00
負債和所有者權益總計 426,230,852,000.00 295,780,147,000.00
法定代表人：
王傳福
主管會計工作負責人：
周亞琳
會計機構負責人：
劉惠
19
四、四、 季度財務報表（續） 季度財務報表（續）
（一） 財務報表（續） 財務報表（續）
22、、 合併年初到報告期末利潤表 合併年初到報告期末利潤表
單位：人民幣元
項目 本期發生額 上期發生額
一、一、 營業總收入 營業總收入 267,687,847,000.00 145,192,358,000.00
其中：營業收入 267,687,847,000.00 145,192,358,000.00
二、二、 營業總成本 營業總成本 254,904,996,000.00 142,770,561,000.00
其中：營業成本 225,146,947,000.00 126,353,739,000.00
稅金及附加 4,462,138,000.00 1,769,060,000.00
銷售費用 9,355,972,000.00 4,258,573,000.00
管理費用 6,409,600,000.00 3,783,509,000.00
研發費用 10,870,017,000.00 5,233,772,000.00
財務費用 -1,339,678,000.00 1,371,908,000.00
其中：利息費用 1,032,039,000.00 1,543,298,000.00
利息收入 1,266,510,000.00 396,020,000.00
加：其他收益 1,150,916,000.00 1,507,475,000.00
投資收益（損失以「-」號填列） -332,052,000.00 -28,291,000.00
其中：對聯營企業和
合營企業的投資收益 -373,613,000.00 -51,501,000.00
以攤餘成本計量的
金融資產終止確認收益 -13,380,000.00 -85,546,000.00
公允價值變動收益
（損失以「-」號填列） -47,564,000.00 57,196,000.00
信用減值損失
（損失以「-」號填列） -548,525,000.00 -106,378,000.00
資產減值損失
（損失以「-」號填列） -898,693,000.00 -239,613,000.00
資產處置收益
（損失以「-」號填列） -21,566,000.00 256,606,000.00
三、三、 營業利潤（虧損以「 營業利潤（虧損以「--」號填列） 」號填列） 12,085,367,000.00 3,868,792,000.00
加：營業外收入 290,225,000.00 289,029,000.00
減：營業外支出 256,479,000.00 231,365,000.00
20
四、四、 季度財務報表（續） 季度財務報表（續）
（一） 財務報表（續） 財務報表（續）
22、、 合併年初到報告期末利潤表（續）
單位：人民幣元
項目 本期發生額 上期發生額
四、四、 利潤總額（虧損總額以「 利潤總額（虧損總額以「--」號填列） 」號填列） 12,119,113,000.00 3,926,456,000.00
減：所得稅費用 2,130,753,000.00 629,913,000.00
五、五、 淨利潤（淨虧損以「 淨利潤（淨虧損以「--」號填列） 」號填列） 9,988,360,000.00 3,296,543,000.00
（一）按經營持續性分類
1. 持續經營淨利潤（淨虧損以
「-」號填列） 9,988,360,000.00 3,296,543,000.00
2. 終止經營淨利潤（淨虧損以
「-」號填列）
（二）按所有權歸屬分類
1. 歸屬於母公司所有者的淨利
潤 9,311,467,000.00 2,443,112,000.00
2. 少數股東損益 676,893,000.00 853,431,000.00
六、六、 其他綜合收益的稅後淨額 其他綜合收益的稅後淨額 -215,747,000.00 -264,695,000.00
歸屬母公司所有者的其他綜合收益
的稅後淨額 -214,544,000.00 -263,424,000.00
（一）不能重分類進損益的其他綜合
收益 48,086,000.00 -242,453,000.00
1. 重新計量設定受益計劃變動
額
2. 權益法下不能轉損益的其他
綜合收益
3. 其他權益工具投資公允價值
變動 49,799,000.00 -242,453,000.00
21
四、四、 季度財務報表（續） 季度財務報表（續）
（一） 財務報表（續） 財務報表（續）
22、、 合併年初到報告期末利潤表（續）
單位：人民幣元
項目 本期發生額 上期發生額
4. 企業自身信用風險公允價值
變動
5. 所得稅影響 -1,713,000.00
6. 其他
（二）將重分類進損益的其他綜合收
益 -262,630,000.00 -20,971,000.00
1. 權益法下可轉損益的其他綜
合收益
2. 其他債權投資公允價值變動
3. 金融資產重分類計入其他綜
合收益的金額
4. 其他債權投資信用減值準備
5. 現金流量套期儲備
6. 外幣財務報表折算差額 -262,739,000.00 -42,039,000.00
7. 應收款項融資公允價值變動 183,000.00 17,703,000.00
8. 應收款項融資信用減值準備 -74,000.00 3,365,000.00
9. 其他
歸屬於少數股東的其他綜合
收益的稅後淨額 -1,203,000.00 -1,271,000.00
22
四、四、 季度財務報表（續） 季度財務報表（續）
（一） 財務報表（續） 財務報表（續）
22、、 合併年初到報告期末利潤表（續）
單位：人民幣元
項目 本期發生額 上期發生額
七、七、 綜合收益總額 綜合收益總額 9,772,613,000.00 3,031,848,000.00
歸屬於母公司所有者的綜合
收益總額 9,096,613,000.00 2,179,688,000.00
歸屬於少數股東的綜合收益總額 675,690,000.00 852,160,000.00
八、八、 每股收益： 每股收益：
（一）基本每股收益 3.20 0.85
（二）稀釋每股收益 3.20 0.85
本期發生同一控制下企業合併的，被合併方在合併前實現的淨利潤為：0.00
元，上期被合併方實現的淨利潤為：0.00元。
法定代表人：
王傳福
主管會計工作負責人：
周亞琳
會計機構負責人：
劉惠
23
四、四、 季度財務報表（續） 季度財務報表（續）
（一） 財務報表（續） 財務報表（續）
33、、 合併年初到報告期末現金流量表 合併年初到報告期末現金流量表
單位：人民幣元
項目 本期發生額 上期發生額
一、一、 經營活動產生的現金流量： 經營活動產生的現金流量：
銷售商品、提供勞務收到的現金 278,809,515,000.00 129,994,762,000.00
收到的稅費返還 6,134,960,000.00 3,251,963,000.00
收到其他與經營活動有關的現金 6,268,305,000.00 2,986,765,000.00
經營活動現金流入小計 291,212,780,000.00 136,233,490,000.00
購買商品、接受勞務支付的現金 148,878,513,000.00 75,270,056,000.00
支付給職工以及為職工支付的現金 35,943,633,000.00 19,988,910,000.00
支付的各項稅費 10,291,529,000.00 4,728,294,000.00
支付其他與經營活動有關的現金 5,062,372,000.00 4,372,519,000.00
經營活動現金流出小計 200,176,047,000.00 104,359,779,000.00
經營活動產生的現金流量淨額 91,036,733,000.00 31,873,711,000.00
二、二、 投資活動產生的現金流量： 投資活動產生的現金流量：
收回投資收到的現金 13,779,000.00
取得投資收益收到的現金 75,348,000.00 131,238,000.00
處置固定資產、無形資產和其他長期
資產收回的現金淨額 258,978,000.00 649,907,000.00
處置子公司及其他營業單位收到的
現金淨額 931,000.00
收到其他與投資活動有關的現金 10,383,823,000.00 10,440,459,000.00
投資活動現金流入小計 10,731,928,000.00 11,222,535,000.00
購建固定資產、無形資產和其他長期
資產支付的現金 64,278,202,000.00 20,719,095,000.00
投資支付的現金 7,616,090,000.00 955,647,000.00
支付其他與投資活動有關的現金 22,495,063,000.00 11,837,332,000.00
投資活動現金流出小計 94,389,355,000.00 33,512,074,000.00
投資活動產生的現金流量淨額 -83,657,427,000.00 -22,289,539,000.00
24
四、四、 季度財務報表（續） 季度財務報表（續）
（一） 財務報表（續） 財務報表（續）
33、、 合併年初到報告期末現金流量表（續） 合併年初到報告期末現金流量表（續）
單位：人民幣元
項目 本期發生額 上期發生額
三、三、 籌資活動產生的現金流量： 籌資活動產生的現金流量：
吸收投資收到的現金 472,625,000.00 25,561,668,000.00
其中：子公司吸收少數股東投資
收到的現金
取得借款收到的現金 19,637,913,000.00 27,937,696,000.00
收到其他與籌資活動有關的現金
籌資活動現金流入小計 20,110,538,000.00 53,499,364,000.00
償還債務支付的現金 29,858,069,000.00 37,139,631,000.00
分配股利、利潤或償付利息支付的現金 1,573,927,000.00 2,373,287,000.00
其中：子公司支付給少數股東的
股利、利潤 79,464,000.00 185,931,000.00
支付的其他權益工具利息 61,600,000.00
贖回永續債支付的現金 1,100,000,000.00
支付其他與籌資活動有關的現金 4,676,530,000.00 3,540,908,000.00
籌資活動現金流出小計 36,108,526,000.00 44,153,826,000.00
籌資活動產生的現金流量淨額 -15,997,988,000.00 9,345,538,000.00
四、四、 匯率變動對現金及現金等價物的影響 匯率變動對現金及現金等價物的影響 425,001,000.00 -8,546,000.00
五、五、 現金及現金等價物淨增加額 現金及現金等價物淨增加額 -8,193,681,000.00 18,921,164,000.00
加：期初現金及現金等價物餘額 49,819,860,000.00 13,738,498,000.00
六、六、 期末現金及現金等價物餘額 期末現金及現金等價物餘額 41,626,179,000.00 32,659,662,000.00
四、 季度財務報表（續）
（二） 審計報告
第三季度報告是否經過審計
□ 是　✓ 否
公司第三季度報告未經審計。
承董事會命
比亞迪股份有限公司
主席
王傳福
中國‧深圳，二零二二年十月二十八日
於本公告刊發日期，本公司的董事會包括執行董事王傳福先生、非執行董事呂向
陽先生及夏佐全先生、獨立非執行董事蔡洪平先生、張敏先生及蔣岩波先生。
本公告原文以中文編製，英文為譯本，如有歧義，概以中文版為準。
25"""
    # A) 段落级 paragraph
    # B) 句子级 sentence
    # C) 字符级 char
    # chunk_size：对小型LLM（上下文2Ktoken）推荐256–512字符；对GPT‑4o等128K‑token窗口可放宽至2K +。
    # granularity：报告 / 合同 → "paragraph"（语义更完整）；FAQ / 问答 → "sentence"（颗粒度适中）；代码 / 超长句边缘 → "char"（兜底）。
    # overlap_units：句级 / 段级通常1‑3；字符级按窗口5–50。

    ps = FlexibleRecursiveSplitter(granularity="sentence", chunk_size=1024, overlap_units=1)
    import time

    start_time = time.time()
    # organizer = ChunkOrganizer()
    # blocks = []
    # for i, chunk in enumerate(ps.split(txt), 1):
    #     blocks = organizer.process(chunk)
    #     print(f"{i:02d}｜{chunk}")
    end_time = time.time()

    print(ps.split(txt))
    print("程序运行时间：%s 秒" % (end_time - start_time))
